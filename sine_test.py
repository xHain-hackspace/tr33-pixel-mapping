import socket
import time
import random
import cv2
import numpy as np
import math

#mapping data
Y_MIN = 27.0
Y_MAX = 477.0
X_MIN = 93.0
X_MAX = 577.0

led_data = [[9,0,326.084014893,336.557342529],
[9,1,324.962677002,331.226104736],
[9,2,325.852294922,325.94152832],
[9,3,325.799285889,320.798522949],
[9,4,325.260437012,315.601623535],
[9,5,324.967559814,310.426422119],
[9,6,324.072479248,305.288604736],
[9,7,323.19140625,299.935455322],
[9,8,322.723022461,294.537384033],
[9,9,322.62210083,289.246124268],
[9,10,322.261413574,284.151885986],
[9,11,321.003601074,280.403198242],
[9,12,319.06842041,274.786590576],
[9,13,320.561889648,268.955200195],
[9,14,322.819976807,264.861297607],
[9,15,324.499786377,259.913543701],
[9,16,326.171478271,255.847579956],
[9,17,329.403991699,252.390411377],
[9,18,330.567718506,244.159194946],
[9,19,328.822570801,238.711791992],
[9,20,326.208496094,233.671585083],
[9,21,324.782806396,229.179702759],
[9,22,321.519805908,224.178253174],
[9,23,316.539398193,220.443695068],
[9,24,310.518127441,219.379516602],
[9,25,306.134246826,217.456375122],
[9,26,302.216644287,214.881622314],
[9,27,298.361877441,213.377349854],
[9,28,293.842468262,209.901138306],
[9,29,288.740875244,207.747650146],
[9,30,282.651245117,206.388595581],
[9,31,281.410552979,202.267379761],
[9,32,280.821166992,194.695953369],
[9,33,281.049072266,189.445526123],
[9,34,280.923492432,184.560958862],
[9,35,280.841278076,180.09072876],
[9,36,280.682495117,174.840270996],
[9,37,280.365844727,170.647384644],
[9,38,281.122497559,168.931091309],
[9,39,282.839996338,169.549713135],
[9,40,284.760314941,170.310150146],
[9,41,290.111938477,170.652496338],
[9,42,283.536376953,160.446304321],
[9,43,280.792877197,157.74382019],
[9,44,277.073242188,155.017166138],
[9,45,272,153.5],
[9,46,266.25213623,133.091445923],
[9,47,259.355773926,133.888519287],
[9,48,257.751586914,150.5],
[9,49,252.898834229,149.725662231],
[9,50,245.933959961,134.028671265],
[9,51,243.560256958,135.220626831],
[9,52,241.880599976,136.944519043],
[9,53,240.328186035,137.650817871],
[9,54,241.759521484,137.406112671],
[9,55,243.025634766,137.301620483],
[9,56,237.51612854,133.453567505],
[9,57,234.416534424,130.233093262],
[9,58,229.962936401,127.284713745],
[9,59,227.188613892,125.707061768],
[9,60,225.667251587,125.512115479],
[9,61,225.449050903,126.918754578],
[9,62,221.623138428,129.517227173],
[9,63,217.611724854,133.500411987],
[9,64,223.109771729,165.425857544],
[9,65,214.961090088,135.344818115],
[9,66,215.23600769,133.16418457],
[9,67,216.128097534,129.683685303],
[9,68,217.357315063,125.228477478],
[9,69,218.870162964,119.680412292],
[9,70,220.483779907,113.521636963],
[9,71,221.901535034,107.292030334],
[9,72,223.418289185,104.972213745],
[9,73,223.947998047,103.545379639],
[9,74,224.251846313,104.347541809],
[9,75,222.974105835,106.391708374],
[9,76,225.952865601,111.190238953],
[9,77,228.756774902,116.033843994],
[9,78,231.540847778,118.649513245],
[9,79,234.20249939,119.097938538],
[9,80,236.555786133,116.945762634],
[9,81,238.48866272,112.753715515],
[9,82,239.875595093,107.216842651],
[9,83,240.639328003,101.230110168],
[9,84,240.918991089,94.5385437012],
[9,85,241.187744141,84.6487884521],
[9,86,240.655609131,81.6015396118],
[9,87,240.201660156,79.488899231],
[9,88,240.228805542,77.5824356079],
[9,89,240.281036377,75.3262329102],
[10,0,332.100921631,335.502807617],
[10,1,333.490478516,331.602630615],
[10,2,334.280181885,325.534851074],
[10,3,334.153259277,319.780151367],
[10,4,332.84487915,314.353881836],
[10,5,332.894561768,308.672210693],
[10,6,331.125946045,303.577362061],
[10,7,329.514434814,298.999053955],
[10,8,328.4765625,293.741271973],
[10,9,327.75881958,290.459533691],
[10,10,326.709442139,287.614837646],
[10,11,326.204742432,280.708526611],
[10,12,325.786682129,275.518035889],
[10,13,326.579772949,270.427246094],
[10,14,327.615600586,265.413391113],
[10,15,327.451660156,259.40826416],
[10,16,328.862304688,256.230651855],
[10,17,330.996826172,252.190643311],
[10,18,330.90447998,247.334686279],
[10,19,331.012390137,243.335083008],
[10,20,331.708312988,238.577728271],
[10,21,332.231811523,233.351821899],
[10,22,333.345916748,228.127120972],
[10,23,333.120361328,223.011016846],
[10,24,333.339935303,218.027633667],
[10,25,332.50177002,212.956329346],
[10,26,331,208.5],
[10,27,329.621368408,204.0703125],
[10,28,327.101715088,199.640304565],
[10,29,324.524200439,195.628921509],
[10,30,321.543212891,191.619110107],
[10,31,319.65927124,189.809768677],
[10,32,317.684906006,186.312835693],
[10,33,316.017120361,178.225158691],
[10,34,313.206878662,174.420806885],
[10,35,305.70690918,170.755966187],
[10,36,305.183410645,168.560546875],
[10,37,305.074951172,166.218978882],
[10,38,303.233123779,163.085983276],
[10,39,300.222747803,159.493743896],
[10,40,296.642211914,154.007232666],
[10,41,294.360198975,155.667556763],
[10,42,292.327575684,155.726898193],
[10,43,288.136047363,148.313018799],
[10,44,285.409057617,144.404098511],
[10,45,282.530395508,141.916366577],
[10,46,278.898101807,141.250595093],
[10,47,276.065856934,137.486709595],
[10,48,272.128448486,135.475692749],
[10,49,268.272583008,134.630569458],
[10,50,263.697540283,132.877685547],
[10,51,260.018341064,130.748153687],
[10,52,256.459289551,129.451599121],
[10,53,252.577972412,128.302993774],
[10,54,248.976486206,126.542266846],
[10,55,245.739181519,125.263648987],
[10,56,243.701385498,123.066795349],
[10,57,248.060714722,121.503379822],
[10,58,250.943481445,122.215270996],
[10,59,255.585586548,148.951721191],
[10,60,243.378387451,125.344924927],
[10,61,244.16998291,124.379127502],
[10,62,245.079803467,122.816642761],
[10,63,246.339691162,120.733459473],
[10,64,247.526046753,118.517677307],
[10,65,248.760528564,116.110237122],
[10,66,250.429779053,113.742584229],
[10,67,252.09085083,111.68724823],
[10,68,254.134246826,108.205245972],
[10,69,256.277404785,105.021018982],
[10,70,258.425689697,101.945594788],
[10,71,260.354705811,98.0502700806],
[10,72,262.798370361,93.6133270264],
[10,73,267.907318115,87.5969772339],
[10,74,269.961547852,84.4029388428],
[10,75,270.779663086,81.5694961548],
[10,76,272.518676758,78.66015625],
[10,77,275.022918701,76.1906051636],
[10,78,271.283630371,74.7283248901],
[10,79,270.996856689,77.0051193237],
[10,80,279.011138916,81.6496963501],
[10,81,279.888153076,81.1393966675],
[10,82,280.052368164,78.832321167],
[10,83,279.49319458,75.2072982788],
[10,84,278.587677002,70.1438522339],
[10,85,277.397491455,63.8909454346],
[10,86,276.643096924,57.1454467773],
[10,87,275.851531982,51.2200698853],
[10,88,275.45223999,45.559967041],
[10,89,275.114624023,42.1550292969],
[11,0,349.620147705,355.374389648],
[11,1,351.564788818,353.664550781],
[11,2,354.992034912,349.283050537],
[11,3,357.785247803,345.411621094],
[11,4,360.869262695,341.530792236],
[11,5,364.40927124,337.079650879],
[11,6,368.669708252,332.85357666],
[11,7,371.077911377,328.125305176],
[11,8,373.107635498,323.400115967],
[11,9,375.436767578,318.604095459],
[11,10,377.655792236,314.070861816],
[11,11,381.553466797,309.644470215],
[11,12,384.127166748,303.473297119],
[11,13,384.909912109,298.921447754],
[11,14,384.996459961,295.522949219],
[11,15,385.72088623,290.739135742],
[11,16,387.244720459,286.255157471],
[11,17,390.275054932,281.674743652],
[11,18,394.141021729,277.572387695],
[11,19,397.61315918,274.189147949],
[11,20,398.422332764,271.79888916],
[11,21,398.785827637,269.722869873],
[11,22,397.749481201,269.147674561],
[11,23,397.570495605,268.179382324],
[11,24,397.250732422,265.376190186],
[11,25,397.462341309,262.20098877],
[11,26,397.254425049,255.453613281],
[11,27,413.013641357,253.218048096],
[11,28,410.47555542,249.48576355],
[11,29,403.134277344,244.020324707],
[11,30,404.467895508,249.444900513],
[11,31,398.847412109,232.25012207],
[11,32,401.895874023,230.209396362],
[11,33,405.928344727,226.836181641],
[11,34,407.4894104,222.295059204],
[11,35,406.595336914,216.72203064],
[11,36,406.5753479,211.433807373],
[11,37,405.940582275,206.993652344],
[11,38,400.827301025,200.563110352],
[11,39,398.984649658,196.213806152],
[11,40,397.57043457,191.359832764],
[11,41,396.597045898,186.772583008],
[11,42,395.596832275,181.857818604],
[11,43,394.461853027,177.432540894],
[11,44,408.158081055,163.471374512],
[11,45,405.501556396,162.115844727],
[11,46,402.89855957,160.693603516],
[11,47,397.146789551,159.075195312],
[11,48,400.291290283,158.201965332],
[11,49,404.190551758,157.74887085],
[11,50,408.891265869,156.968795776],
[11,51,413.438903809,156.566101074],
[11,52,418.261444092,155.806274414],
[11,53,422.772766113,153.524978638],
[11,54,427.49420166,151.23274231],
[11,55,432.147766113,149.391387939],
[11,56,436.758575439,147.869216919],
[11,57,441.342315674,146.245101929],
[11,58,446.214202881,145.100326538],
[11,59,451.004394531,143.347579956],
[11,60,455.680755615,141.457168579],
[11,61,460.644805908,139.705215454],
[11,62,465.118347168,137.942886353],
[11,63,470.182830811,135.620437622],
[11,64,474.746185303,133.795883179],
[11,65,479.5,131],
[11,66,484.405578613,128.951141357],
[11,67,489.235198975,127.24785614],
[11,68,494.115753174,125.533111572],
[11,69,498.21496582,123.957794189],
[11,70,501.512329102,122.347061157],
[11,71,503.743041992,121.762924194],
[11,72,509.109832764,123.229156494],
[11,73,513.505859375,124.095092773],
[11,74,517.611450195,124.788139343],
[11,75,521.337646484,124.687957764],
[11,76,524.992431641,123.226638794],
[11,77,529.064025879,121.304527283],
[11,78,533.29888916,119.509437561],
[11,79,537.458251953,117.535987854],
[11,80,541.589904785,114.897262573],
[11,81,545.276550293,111.526306152],
[11,82,548.982910156,108.383094788],
[11,83,552.677734375,104.862236023],
[11,84,556.396911621,101.008842468],
[11,85,559.932617188,96.7711715698],
[11,86,563.765930176,91.7703857422],
[11,87,568.604064941,87.0164413452],
[11,88,572.372558594,83.2094039917],
[11,89,576.652282715,80.427192688],
[13,0,349.453918457,347.836090088],
[13,1,349.52444458,347.497161865],
[13,2,355.558746338,346.359954834],
[13,3,357.684509277,336.520904541],
[13,4,359.742889404,331.104858398],
[13,5,360.565246582,325.795684814],
[13,6,360.740631104,320.41116333],
[13,7,360.186798096,315.815032959],
[13,8,359.456298828,311.298980713],
[13,9,359.720153809,306.288360596],
[13,10,360.283569336,301.036376953],
[13,11,361.854553223,295.919158936],
[13,12,361.106994629,290.547088623],
[13,13,360.909759521,285.253509521],
[13,14,358.964508057,280.927642822],
[13,15,358.768035889,275.097076416],
[13,16,357.891937256,271.003356934],
[13,17,358.952728271,266.051208496],
[13,18,358.3487854,260.923278809],
[13,19,358.370269775,255.362243652],
[13,20,358.215454102,250.383666992],
[13,21,357.914855957,245.260620117],
[13,22,357.255737305,240.313812256],
[13,23,356.482849121,235.740570068],
[13,24,356.095153809,230.767944336],
[13,25,355.691894531,225.572738647],
[13,26,354.990875244,220.744918823],
[13,27,354.356567383,215.744094849],
[13,28,353.575775146,211.134613037],
[13,29,353.051361084,206.233032227],
[13,30,352.183166504,201.182556152],
[13,31,351.3777771,196.479537964],
[13,32,350.596954346,192.35269165],
[13,33,350.293762207,187.482696533],
[13,34,349.69354248,182.058364868],
[13,35,349.000823975,176.858016968],
[13,36,348.646759033,171.916671753],
[13,37,348.079315186,167.510025024],
[13,38,346.000610352,163.169754028],
[13,39,343.448822021,159.560668945],
[13,40,342.018432617,153.952285767],
[13,41,342.035247803,144.906646729],
[13,42,339.962432861,149.573577881],
[13,43,338.45904541,154.827484131],
[13,44,336.917236328,156.76802063],
[13,45,335.016845703,158.795196533],
[13,46,336.924407959,144.330276489],
[13,47,337.220458984,142.598602295],
[13,48,337.51083374,140.896347046],
[13,49,338.324310303,139.547073364],
[13,50,338.564422607,138.716079712],
[13,51,339.382507324,137.358093262],
[13,52,339.99810791,134.694503784],
[13,53,340.480895996,132.042907715],
[13,54,340.783203125,128.9090271],
[13,55,340.587799072,124.928977966],
[13,56,340.619293213,120.149810791],
[13,57,340.587799072,115.597290039],
[13,58,340.524688721,112.818321228],
[13,59,342.262298584,110.95790863],
[13,60,339.810882568,110.619842529],
[13,61,342.133880615,108.659408569],
[13,62,351.186401367,106.263397217],
[13,63,356.906982422,104.021743774],
[13,64,360.332244873,102.1769104],
[13,65,349.718780518,106.404541016],
[13,66,348.170410156,105.867172241],
[13,67,350.205322266,103.932319641],
[13,68,352.381622314,101.847648621],
[13,69,354.707855225,99.8166809082],
[13,70,356.924224854,97.4752883911],
[13,71,359.184661865,95.0421600342],
[13,72,361.492370605,92.4240036011],
[13,73,363.862487793,89.6527404785],
[13,74,366.273864746,87.091796875],
[13,75,368.6902771,83.9766540527],
[13,76,371.387939453,80.4404602051],
[13,77,374.139312744,76.7382583618],
[13,78,376.636138916,72.5155410767],
[13,79,379.206329346,68.4885025024],
[13,80,381.627868652,64.3052139282],
[13,81,383.912872314,59.0622749329],
[13,82,386.362365723,54.115737915],
[13,83,388.627380371,48.791229248],
[13,84,391.153991699,43.8840103149],
[13,85,394.267242432,38.5229492188],
[13,86,396.63168335,34.7753715515],
[13,87,397.527191162,32.0120429993],
[13,88,401.042480469,29.4951763153],
[13,89,403.97668457,27.397397995],
[14,0,314.970977783,334.784820557],
[14,1,314.420288086,331.184448242],
[14,2,314.710784912,325.254516602],
[14,3,314.00793457,319.725463867],
[14,4,313.124450684,314.644989014],
[14,5,312.208740234,309.765136719],
[14,6,311.246765137,305.064575195],
[14,7,308.879608154,299.529418945],
[14,8,309.414123535,296.19821167],
[14,9,308.599914551,291.350189209],
[14,10,307.323364258,286.142913818],
[14,11,305.370391846,282.50289917],
[14,12,304.029266357,279.086761475],
[14,13,301.443725586,273.65814209],
[14,14,298.92880249,269.498718262],
[14,15,295.903991699,265.116577148],
[14,16,294.310760498,260.161560059],
[14,17,292.808837891,256.000213623],
[14,18,291.847747803,251.634506226],
[14,19,290.791870117,247.432632446],
[14,20,289.836395264,243.372619629],
[14,21,288.412811279,238.3621521],
[14,22,286.831665039,234.457550049],
[14,23,284.98449707,229.529449463],
[14,24,283.56640625,225.585083008],
[14,25,282.287780762,221.050674438],
[14,26,281.079406738,216.302902222],
[14,27,280.619354248,212.287094116],
[14,28,279.838745117,208.263137817],
[14,29,278.092132568,202.32131958],
[14,30,277.041412354,197.547454834],
[14,31,276.128845215,192.881225586],
[14,32,289.158203125,190.632385254],
[14,33,281.780883789,184.661483765],
[14,34,269.946044922,178.477050781],
[14,35,265.529052734,183.594985962],
[14,36,262.709655762,189.484970093],
[14,37,261.175964355,194.352523804],
[14,38,260.662750244,199.742004395],
[14,39,259.132751465,203.709075928],
[14,40,257.658111572,206.568969727],
[14,41,257.578125,207.599822998],
[14,42,255.727630615,207.605300903],
[14,43,252.356781006,206.668930054],
[14,44,249.05380249,203.613983154],
[14,45,246.028762817,199.465789795],
[14,46,243.400466919,195.442153931],
[14,47,240.086898804,191.00088501],
[14,48,237.589126587,188.913131714],
[14,49,236.390014648,189.959014893],
[14,50,233.680999756,190.382217407],
[14,51,228.263549805,179.429367065],
[14,52,226.715209961,174.810714722],
[14,53,226.876327515,170.129272461],
[14,54,224.060821533,164.454437256],
[14,55,224.754058838,160.880935669],
[14,56,227.349212646,158.986206055],
[14,57,228.795135498,157.448120117],
[14,58,229.189117432,154.711257935],
[14,59,229.147888184,151.084686279],
[14,60,225.723968506,139.28553772],
[14,61,225.360595703,138.700241089],
[14,62,219.637878418,136.947479248],
[14,63,209.289367676,136.627624512],
[14,64,204.573974609,136.486022949],
[14,65,201.483657837,134.542526245],
[14,66,199.619049072,134.508453369],
[14,67,197.492080688,134.139770508],
[14,68,195.679016113,133.50553894],
[14,69,193.97026062,133.354873657],
[14,70,193.085266113,132.246398926],
[14,71,192.335098267,131.087020874],
[14,72,190.890975952,129.257797241],
[14,73,181.945419312,134.072463989],
[14,74,179.877807617,130.324172974],
[14,75,178.829803467,125.784065247],
[14,76,177.831741333,123.545516968],
[14,77,177.870422363,122.84740448],
[14,78,178.160095215,122.327186584],
[14,79,178.127212524,124.332145691],
[14,80,168.657791138,114.39213562],
[14,81,175.052505493,123.862045288],
[14,82,175.571884155,121.612800598],
[14,83,176.213882446,118.022918701],
[14,84,176.896011353,113.402961731],
[14,85,177.394210815,108.146537781],
[14,86,177.928970337,103.85004425],
[14,87,178.753417969,100.988334656],
[14,88,179.114639282,98.8747329712],
[14,89,179.925445557,96.8464508057],
[15,0,306.169036865,345.059112549],
[15,1,303.240722656,337.619018555],
[15,2,304.582824707,331.443206787],
[15,3,304.622680664,326.161895752],
[15,4,303.984985352,320.804473877],
[15,5,303.1796875,315.854614258],
[15,6,302.188964844,310.969787598],
[15,7,301.76071167,306.175537109],
[15,8,300.987426758,300.981903076],
[15,9,300.328430176,295.953033447],
[15,10,298.693206787,290.948913574],
[15,11,297.859344482,285.469055176],
[15,12,296.366729736,280.279418945],
[15,13,295.087677002,275.489776611],
[15,14,292.749694824,271.160919189],
[15,15,290.193603516,267.138946533],
[15,16,288.472717285,262.407073975],
[15,17,284.701202393,258.55645752],
[15,18,282.290435791,255.715164185],
[15,19,280.822509766,253.764266968],
[15,20,279.583831787,251.652435303],
[15,21,277.288757324,245.221405029],
[15,22,289.907928467,251.375366211],
[15,23,289.133361816,247.150222778],
[15,24,272.176605225,239.23274231],
[15,25,268.358215332,242.016296387],
[15,26,263.994934082,245.054031372],
[15,27,258.158996582,248.264694214],
[15,28,256.897399902,251.142684937],
[15,29,253.510055542,254.679977417],
[15,30,247.043899536,258.66696167],
[15,31,239.541687012,256.684020996],
[15,32,235.260375977,251.984344482],
[15,33,232.799682617,247.843795776],
[15,34,230.54800415,243.334732056],
[15,35,227.726394653,239.006439209],
[15,36,224.597763062,235.153656006],
[15,37,221.082214355,231.183181763],
[15,38,217.837478638,227.303543091],
[15,39,214.349700928,225.111541748],
[15,40,209.435424805,224.807571411],
[15,41,202.70803833,219.778213501],
[15,42,200.703063965,212.302246094],
[15,43,201.806594849,205.882141113],
[15,44,205.672348022,199.95274353],
[15,45,209.624008179,195.169006348],
[15,46,213.185150146,191.976242065],
[15,47,214.806991577,189.689437866],
[15,48,214.976257324,187.975769043],
[15,49,215.479064941,182.991912842],
[15,50,212.950424194,178.239151001],
[15,51,210.916702271,176.606216431],
[15,52,209.681655884,175.858978271],
[15,53,203.110534668,169.489501953],
[15,54,200.562850952,165.747589111],
[15,55,193.849319458,162.802871704],
[15,56,194.593643188,162.272033691],
[15,57,194.786361694,159.091384888],
[15,58,188.684738159,134.303344727],
[15,59,187.437469482,135.474380493],
[15,60,180.826263428,137.006164551],
[15,61,170.733062744,139.766174316],
[15,62,168.047164917,144.078552246],
[15,63,172.576690674,166.010665894],
[15,64,172.729690552,170.361480713],
[15,65,173.119796753,175.141555786],
[15,66,173.304275513,179.349975586],
[15,67,173.670639038,181.996612549],
[15,68,168.307754517,143.236343384],
[15,69,168.540328979,143.176940918],
[15,70,173.770004272,188.279998779],
[15,71,170.206756592,189.847808838],
[15,72,167.859024048,189.973419189],
[15,73,165.793045044,189.045837402],
[15,74,160.637237549,186.852645874],
[15,75,154.805877686,186.279144287],
[15,76,150.553894043,186.280960083],
[15,77,146.299057007,184.615493774],
[15,78,142.114471436,182.658676147],
[15,79,138.692749023,180.455856323],
[15,80,127.751350403,150.763290405],
[15,81,134.2159729,154.783355713],
[15,82,137.160125732,157.979400635],
[15,83,137.997451782,159.105285645],
[15,84,138.519241333,160.052398682],
[15,85,138.961776733,159.303771973],
[15,86,139.639633179,159.697006226],
[15,87,140.099578857,161.442077637],
[15,88,140.316879272,162.954162598],
[15,89,140.553756714,165.076705933],
[16,0,345.517333984,349.457366943],
[16,1,348.83807373,345.424530029],
[16,2,349.557159424,340.670593262],
[16,3,351.146453857,335.878753662],
[16,4,354.6121521,331.590148926],
[16,5,356.16986084,326.929901123],
[16,6,359.75390625,322.068084717],
[16,7,361.475189209,317.472564697],
[16,8,362.813293457,312.740875244],
[16,9,364.070770264,307.707366943],
[16,10,364.416748047,302.170166016],
[16,11,364.667633057,297.093048096],
[16,12,365.559997559,292.145721436],
[16,13,366.675354004,287.06854248],
[16,14,368.610565186,282.023406982],
[16,15,370.245513916,276.737243652],
[16,16,371.462585449,271.692352295],
[16,17,372.959869385,266.673461914],
[16,18,374.170654297,261.753540039],
[16,19,375.487487793,256.858642578],
[16,20,377.00567627,252.050430298],
[16,21,378.373199463,247.140625],
[16,22,379.884765625,241.687362671],
[16,23,379.777099609,237.069549561],
[16,24,378.818634033,231.637908936],
[16,25,378.982391357,226.729019165],
[16,26,379.24206543,221.740997314],
[16,27,379.652130127,216.588394165],
[16,28,380.392578125,211.926345825],
[16,29,380.890289307,206.971786499],
[16,30,380.48135376,201.835662842],
[16,31,380.413482666,196.903701782],
[16,32,379.49307251,191.711135864],
[16,33,379.013244629,188.192855835],
[16,34,377.72354126,186.663101196],
[16,35,376.39654541,182.741027832],
[16,36,376.008972168,179.609619141],
[16,37,376.253692627,172.845169067],
[16,38,374.874450684,169.195999146],
[16,39,374.010437012,165.456008911],
[16,40,372.76071167,161.25289917],
[16,41,371.575775146,156.095092773],
[16,42,370.603790283,150.577362061],
[16,43,370.065948486,144.732879639],
[16,44,369.234832764,139.661499023],
[16,45,368.169921875,134.075500488],
[16,46,366.454040527,124.578727722],
[16,47,365.361419678,125.875152588],
[16,48,366.585784912,124.364112854],
[16,49,369.681793213,123.803070068],
[16,50,368.617004395,126.376502991],
[16,51,368.442474365,131.500366211],
[16,52,370,133.5],
[16,53,372.424316406,134.021621704],
[16,54,375.130950928,134.436447144],
[16,55,378.024108887,133.774581909],
[16,56,381.139648438,132.73651123],
[16,57,384.834136963,131.303253174],
[16,58,388.409545898,129.156188965],
[16,59,392.009033203,126.481864929],
[16,60,395.914642334,122.980628967],
[16,61,398.914154053,119.135726929],
[16,62,401.91897583,114.788551331],
[16,63,404.436706543,110.090118408],
[16,64,407.267608643,104.886360168],
[16,65,410.26940918,99.0921707153],
[16,66,412.766479492,93.0702896118],
[16,67,415.987365723,89.5208969116],
[16,68,419.156280518,87.1725616455],
[16,69,422.886962891,84.8640518188],
[16,70,429.19732666,83.3477172852],
[16,71,433.706970215,80.8424301147],
[16,72,438.826049805,78.2548522949],
[16,73,442.224151611,75.4152069092],
[16,74,443.734313965,73.214225769],
[16,75,442.808319092,71.2165603638],
[16,76,445.276550293,67.9413757324],
[16,77,448.940093994,64.8595352173],
[16,78,451.291656494,61.44921875],
[16,79,453.934814453,58.0085716248],
[16,80,456.759246826,53.9790458679],
[16,81,459.664855957,50.2163352966],
[16,82,462.474029541,46.5399932861],
[16,83,464.207885742,42.2392616272],
[16,84,466.06350708,37.7139892578],
[16,85,467.689483643,33.7828674316],
[16,86,467.802246094,32.4510803223],
[16,87,467.619415283,34.8705482483],
[16,88,469.856536865,36.6351203918],
[16,89,474.096557617,39.0596580505],
[17,0,287.832397461,339.589233398],
[17,1,281.947479248,336.152099609],
[17,2,281.12121582,329.668304443],
[17,3,280.260162354,325.514770508],
[17,4,279.70425415,320.792877197],
[17,5,279.90020752,315.843505859],
[17,6,280.468963623,311.972717285],
[17,7,281.384979248,308.820983887],
[17,8,282.980163574,303.826171875],
[17,9,283.398498535,297.671936035],
[17,10,283.828308105,291.532226562],
[17,11,276.171478271,289.517852783],
[17,12,276.696777344,287.154968262],
[17,13,268.613555908,283.007446289],
[17,14,262.002929688,281.825439453],
[17,15,256.872711182,283.410644531],
[17,16,253.393310547,284.472625732],
[17,17,250.756210327,283.292877197],
[17,18,248.431884766,280.551300049],
[17,19,246.377227783,276.396697998],
[17,20,243.633575439,271.363555908],
[17,21,239.246017456,267.405670166],
[17,22,235.013687134,264.000793457],
[17,23,231.759628296,260.684143066],
[17,24,229.22315979,256.523529053],
[17,25,228.146621704,250.832122803],
[17,26,224.034301758,246.172897339],
[17,27,218.600067139,243.348190308],
[17,28,213.816848755,242.297012329],
[17,29,210.082931519,239.758850098],
[17,30,206.792495728,236.531005859],
[17,31,203.904052734,233.227752686],
[17,32,202.755111694,229.370162964],
[17,33,202.458404541,225.246963501],
[17,34,202.890335083,220.821456909],
[17,35,202.692245483,214.580123901],
[17,36,200.792953491,209.772598267],
[17,37,197.652481079,204.457839966],
[17,38,193.439437866,200.263000488],
[17,39,188.464874268,198.086502075],
[17,40,185.123260498,196.277526855],
[17,41,182.429107666,193.366760254],
[17,42,176.572570801,189.777603149],
[17,43,171.671722412,197.324432373],
[17,44,170.858001709,203.85786438],
[17,45,170.562469482,209.653900146],
[17,46,170.313934326,215.221710205],
[17,47,170.265609741,220.2371521],
[17,48,169.926040649,224.604660034],
[17,49,170.235046387,228.17149353],
[17,50,169.811279297,228.691055298],
[17,51,169.652359009,228.084411621],
[17,52,169.562530518,228.002166748],
[17,53,168.585098267,229.410644531],
[17,54,166.282867432,229.138656616],
[17,55,163.428359985,227.375732422],
[17,56,160.513824463,224.234481812],
[17,57,157.902648926,220.287322998],
[17,58,156.064056396,215.626831055],
[17,59,154.133270264,211.796340942],
[17,60,152.182785034,208.220108032],
[17,61,150.572021484,204.102920532],
[17,62,123.010192871,144.74597168],
[17,63,120.65372467,147.402404785],
[17,64,134.521942139,151.467819214],
[17,65,119.695045471,156.703445435],
[17,66,119.426177979,159.375244141],
[17,69,145.96534729,190.741149902],
[17,70,142.921157837,191.031311035],
[17,78,125.72984314,189.039123535],
[17,79,122.371315002,187.787460327],
[17,80,120.490104675,186.333938599],
[17,81,120.197906494,184.496124268],
[17,82,119.380126953,181.744140625],
[17,83,117.744346619,174.828765869],
[17,84,114.849723816,172.359710693],
[17,85,111.11932373,172.361251831],
[17,86,108.044998169,172.48866272],
[17,87,102.969963074,172.537841797],
[17,88,97.4820709229,173.081878662],
[17,89,93.2269592285,173.322341919],
[18,0,335.496368408,341.243652344],
[18,1,335.217437744,331.263275146],
[18,2,338.467254639,325.774169922],
[18,3,342.668945312,323.67578125],
[18,4,347.387969971,320.345245361],
[18,5,349.574249268,317.808807373],
[18,6,349.98638916,314.512145996],
[18,7,348.011535645,311.480072021],
[18,8,345.093475342,305.41973877],
[18,9,344.332977295,300.157714844],
[18,10,343.825775146,294.404266357],
[18,11,343.865447998,289.221679688],
[18,12,345.139068604,283.531036377],
[18,13,345.393035889,278.468658447],
[18,14,345.246459961,273.458129883],
[18,15,345.172729492,268.524719238],
[18,16,344.889831543,263.637939453],
[18,17,343.902252197,258.563903809],
[18,18,343.941467285,253.533843994],
[18,19,343.880187988,248.326553345],
[18,20,343.144317627,243.384078979],
[18,21,343.163421631,238.364089966],
[18,22,343.255950928,232.894546509],
[18,23,343.906188965,227.927459717],
[18,24,343.940612793,223.434249878],
[18,25,343.472412109,217.568130493],
[18,26,341.399383545,213.240982056],
[18,27,340.45602417,208.816619873],
[18,28,339.428771973,204.290512085],
[18,29,337.557830811,199.617843628],
[18,30,336.24810791,194.715393066],
[18,32,335.830322266,184.821243286],
[18,33,333.688659668,180.937149048],
[18,34,332.766174316,176.128417969],
[18,35,331.804840088,171.185546875],
[18,36,331.753234863,166.753936768],
[18,37,331.123504639,160.744995117],
[18,38,329.285491943,141.645202637],
[18,39,324.699645996,143.289764404],
[18,40,322.81439209,143.57371521],
[18,41,322.932830811,147.310394287],
[18,42,323.345489502,150.121673584],
[18,43,323.116882324,153.521865845],
[18,44,319.216003418,141.327392578],
[18,45,323.808563232,158.843566895],
[18,46,316.559661865,139.230804443],
[18,47,315.668457031,137.741760254],
[18,48,314.859771729,135.882904053],
[18,49,314.068359375,134.048919678],
[18,50,313.165557861,131.648193359],
[18,51,314.050933838,128.062606812],
[18,52,314.013763428,124.631614685],
[18,53,310.81854248,123.514442444],
[18,54,307.640960693,122.019233704],
[18,55,304.512420654,119.062210083],
[18,56,300.071380615,115.968902588],
[18,57,299.433013916,114.516693115],
[18,58,302.776153564,112.933395386],
[18,59,304.547973633,110.342041016],
[18,60,305.022613525,106.957344055],
[18,61,302.232696533,104.267189026],
[18,62,299.305755615,102.802467346],
[18,63,299.341674805,99.1449966431],
[18,64,297.261169434,98.9281005859],
[18,65,298.04598999,98.0209350586],
[18,66,298.171173096,98.006187439],
[18,67,300.143341064,98.0534820557],
[18,68,305.127380371,97.7372741699],
[18,69,310.803009033,96.8197860718],
[18,70,316.068634033,94.8313751221],
[18,71,319.882598877,91.5553283691],
[18,72,316.186126709,90.5229721069],
[18,73,316.651733398,86.8577880859],
[18,74,318.617736816,85.061706543],
[18,75,322.660705566,82.8251419067],
[18,76,320.444549561,78.9489593506],
[18,77,318.77923584,77.3926315308],
[18,78,316.739257812,76.6182250977],
[18,79,309.165588379,75.4881515503],
[18,80,327.145996094,84.1499252319],
[18,81,327.908966064,83.1834564209],
[18,82,328.748748779,81.4258422852],
[18,83,329.55645752,77.3792648315],
[18,84,330.244750977,72.1549911499],
[18,85,330.768737793,66.287612915],
[18,86,330.79675293,59.6021842957],
[18,87,330.879119873,51.2371253967],
[18,88,330.949951172,47.0908737183],
[18,89,330.895935059,44.4732513428],
[19,0,306.801605225,353.656616211],
[19,1,303.162261963,348.519775391],
[19,2,300.072601318,344.50680542],
[19,3,297.835357666,339.103057861],
[19,4,295.651245117,333.866455078],
[19,5,295.874145508,328.580291748],
[19,6,294.362213135,323.699920654],
[19,7,291.345947266,319.508636475],
[19,8,291.10635376,313.827545166],
[19,9,290.118225098,308.869995117],
[19,10,289.216308594,303.917022705],
[19,11,287.85647583,298.226165771],
[19,12,285.261016846,293.150512695],
[19,13,283.226348877,292.920928955],
[19,14,282.241760254,293],
[19,15,284.32208252,294.573730469],
[19,16,286.060974121,296.025543213],
[19,17,289.099884033,298.762664795],
[19,18,278.34173584,292.599182129],
[19,19,274.82220459,293.493743896],
[19,20,270.039672852,294.469207764],
[19,21,264.323577881,295.783447266],
[19,22,259.320526123,297.216766357],
[19,23,253.884078979,297.689025879],
[19,24,248.201217651,298.478515625],
[19,25,242.803070068,300.637969971],
[19,26,239.371017456,301.43157959],
[19,27,235.736724854,300.695648193],
[19,28,232.237823486,299.037109375],
[19,29,228.043487549,296.139678955],
[19,30,224.325683594,292.87210083],
[19,31,221.070236206,289.507415771],
[19,32,218.989532471,284.904693604],
[19,33,215.213943481,280.008453369],
[19,34,209.728286743,277.119567871],
[19,35,203.666442871,276.87802124],
[19,36,198.210159302,277.194335938],
[19,37,193.085647583,277.360015869],
[19,38,189.876861572,278.323699951],
[19,39,183.582824707,276.550170898],
[19,40,178.875137329,275.506896973],
[19,41,174.291046143,277.96270752],
[19,42,169.324645996,283.009216309],
[19,43,168.455596924,290.212127686],
[19,44,168.434188843,296.253051758],
[19,45,168.385116577,302.973632812],
[19,46,168.062210083,309.048583984],
[19,47,168.290969849,312.087768555],
[19,48,167.645843506,313.443908691],
[19,49,167.646469116,315.060333252],
[19,50,167.009963989,321.617980957],
[19,51,167.589492798,326.193786621],
[19,52,167.765625,330.692321777],
[19,53,166.451385498,335.55758667],
[19,54,164.787445068,340.137298584],
[19,55,161.901870728,344.518218994],
[19,56,158.624267578,348.398895264],
[19,57,153.886962891,351.631469727],
[19,58,149.865875244,354.564331055],
[19,59,146.477111816,359.442779541],
[19,60,144.394958496,365.84942627],
[19,61,144.297241211,372.382720947],
[19,62,145.192398071,377.586517334],
[19,63,145.228820801,381.583435059],
[19,64,143.429321289,386.920257568],
[19,65,141.698684692,391.926757812],
[19,66,141.357452393,397.383453369],
[19,67,141.038864136,403.181243896],
[19,68,141.126022339,408.998016357],
[19,69,142.232223511,414.695465088],
[19,70,143.767227173,419.248352051],
[19,71,143.988372803,424.814849854],
[19,72,145.148010254,430.496459961],
[19,73,146.126708984,435.518341064],
[19,74,147.331436157,440.900482178],
[19,75,148.380371094,446.177978516],
[19,76,149.104110718,451.816802979],
[19,77,148.656219482,457.034332275],
[19,78,147.93637085,462.298583984],
[19,79,146.568939209,466.900512695]]

framebuffer = [[0,0,0]]*len(led_data)
framebuffer_old = [[0,0,1]]*len(led_data)

UDP_IP = "192.168.42.189"
UDP_PORT = 1337

print "UDP target IP:", UDP_IP
print "UDP target port:", UDP_PORT

sock = socket.socket(socket.AF_INET, # Internet
                     socket.SOCK_DGRAM) # UDP

COMMAND_DISABLE = 0
COMMAND_COLOR = 1
COMMAND_UPDATE_SETTINGS = 101
COMMAND_PIXEL = 103
COMMAND_PIXEL_RGB = 104

MODE_COMMANDS = 0
MODE_STREAM = 1

PALETTE_RAINBOW = 0
PALETTE_FOREST = 1

COLORTEMP_NONE = 0

STRIP_ALL = 22

UDP_PACKET_DELAY = 0.00015

#tree control functions

def send_command(command):                     
	sock.sendto(command, (UDP_IP, UDP_PORT))
	
def set_color(index,strip,hue,brightness):
	command_bytes = bytearray()
	command_bytes.append(index)
	command_bytes.append(COMMAND_COLOR)
	command_bytes.append(strip)
	command_bytes.append(hue)
	command_bytes.append(brightness)
	send_command(command_bytes)
	
def update_settings(palette,color_temp, display_mode):
	command_bytes = bytearray()
	command_bytes.append(0)
	command_bytes.append(COMMAND_UPDATE_SETTINGS)
	command_bytes.append(palette)
	command_bytes.append(color_temp)
	command_bytes.append(display_mode)
	send_command(command_bytes)	
	
def set_pixel_stream(strip,pixel, hue):
	command_bytes = bytearray()
	command_bytes.append(0)
	command_bytes.append(COMMAND_PIXEL)
	command_bytes.append(strip)
	command_bytes.append(pixel)
	command_bytes.append(hue)
	send_command(command_bytes)	
	
def set_pixel_rgb_stream(strip,pixel, red, green, blue):
	command_bytes = bytearray()
	command_bytes.append(0)
	command_bytes.append(COMMAND_PIXEL_RGB)
	command_bytes.append(strip)
	command_bytes.append(pixel)
	command_bytes.append(red)
	command_bytes.append(green)
	command_bytes.append(blue)
	send_command(command_bytes)	
	
def disable_all():
	for index in range(0,10):
		command_bytes = bytearray()
		command_bytes.append(index)
		command_bytes.append(COMMAND_DISABLE)
		send_command(command_bytes)
		
#effect lookup functions
def swipe_y(y,fraction,top_color,bottom_color):
	if y<((Y_MAX-Y_MIN)*fraction+Y_MIN):
		color = top_color
	else:
		color = bottom_color
	return color
	
def swipe_x(x,fraction,left_color,right_color):
	if x<((X_MAX-X_MIN)*fraction+X_MIN):
		color = left_color
	else:
		color = right_color
	return color

def square(x_led,y_led,x_square,y_square,size_square,color_square,color_background):
	halfsize = size_square / 2.0
	if (x_led > (x_square-halfsize)) and (x_led < (x_square+halfsize)) and (y_led > (y_square-halfsize)) and (y_led < (y_square+halfsize)):
		return color_square
	else:
		return color_background
	return color
	
def sine(x_led,y_led,pos_x,pos_y,wavelength,phase,color):
	x_led = x_led - ((X_MAX-X_MIN)*pos_x+X_MIN)
	y_led = y_led - ((Y_MAX-Y_MIN)*pos_y+Y_MIN)
	amplitude = 0.5*(1+math.sin(math.sqrt(y_led*y_led+x_led*x_led)/wavelength*2*math.pi-math.pi*2*phase))
	return [int(x * amplitude) for x in color]

#framebuffer check for change and send	
def update_tr33(framebuf,framebuf_old):
	for current_led in range(len(led_data)):#for all leds
		if not(framebuf[current_led] == framebuf_old[current_led]):#if color data has changed
			set_pixel_rgb_stream(led_data[current_led][0],led_data[current_led][1],framebuffer[current_led][0],framebuffer[current_led][1],framebuffer[current_led][2])#update led
			time.sleep(UDP_PACKET_DELAY)
	
		
		
#start main code

#blink and reset tree pixels
print("[INFO] setting initial tree configuration...")
update_settings(PALETTE_RAINBOW,COLORTEMP_NONE,MODE_COMMANDS)
set_color(0,STRIP_ALL,80,2)
time.sleep(0.1)
disable_all()	
update_settings(PALETTE_RAINBOW,COLORTEMP_NONE,MODE_STREAM)

#~ #send intial framebuffer
#~ start = time.time()
#~ update_tr33(framebuffer,framebuffer_old)#send new frame to tr33
#~ framebuffer_old = framebuffer[:] #save new buffer for next update
#~ end = time.time()
#~ print("Updated Tr33 in "+str(round(1000000*(end - start)))+" us.")


#main effect loop
square_color = [0,255,0]
bg_color = [255,0,0]

#prepare tree with background color
print("Sending intial background.")
for current_led in range(len(led_data)):#update all leds
				framebuffer[current_led] = bg_color
update_tr33(framebuffer,framebuffer_old)#send new frame to tr33
framebuffer_old = framebuffer[:] #save new buffer for next update

print("Starting effect.")
phase = 0
while True:
	
	#update effect parameters
	phase = phase + 0.04
	
	#update framebuffer with effect
	start = time.time()
	for current_led in range(len(led_data)):#update all leds according to effect
			framebuffer[current_led] = sine(led_data[current_led][2],led_data[current_led][3],0.5,0.5,50,phase,[255,255,255])
	end = time.time()
	print("Updated Framebuffer in "+str(round(1000000*(end - start)))+" us.")			
	
	#send framebuffer to tr33
	start = time.time()
	update_tr33(framebuffer,framebuffer_old)#send new frame to tr33
	framebuffer_old = framebuffer[:] #save new buffer for next update
	end = time.time()
	print("Updated Tr33 in "+str(round(1000000*(end - start)))+" us.")
	
	#allow OS to do stuff for a bit
	time.sleep(0.001)

#exit	


